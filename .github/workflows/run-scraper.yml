name: Run Harbour Scraper

on:
  schedule:
    # 5 times per day (UTC): 00:05, 04:05, 08:05, 12:05, 16:05
    # (IST = UTC+5:30 → approx 05:35, 09:35, 13:35, 17:35, 21:35)
    - cron: "5 0,4,8,12,16 * * *"
  workflow_dispatch: {}  # allow manual trigger

jobs:
  run-scraper:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # ❌ Removed Firebase file creation — not needed
      # We now pass JSON directly via env variable FIREBASE_KEY_JSON

      - name: Run scraper
        env:
          TG_API_ID: ${{ secrets.TG_API_ID }}
          TG_API_HASH: ${{ secrets.TG_API_HASH }}
          TG_SESSION_STRING: ${{ secrets.TG_SESSION_STRING }}
          ONESIGNAL_APP_ID: ${{ secrets.ONESIGNAL_APP_ID }}
          ONESIGNAL_REST_API_KEY: ${{ secrets.ONESIGNAL_REST_API_KEY }}
          FIREBASE_KEY_JSON: ${{ secrets.FIREBASE_KEY_JSON }}   # ⬅ IMPORTANT
        run: |
          python harbour_scraper.py
